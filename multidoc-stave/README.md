# Multi-document annotation tool

`multidoc-stave` toolkit facilitates collecting annotations for cross-document NLP tasks. It's based on the [Stave](https://github.com/asyml/stave) toolkit. See [README.md](../README.md#annotate_document_pairs) for more details on how to use the toolkit.

## Miscellaneous Features

To compliment the annotation task, the toolkit also provides the following features.

### Visualization

This toolkit can also be used to visualize the finished annotations. The task admins can iterate through annotations directly from the home page (\<HOST\>:\<PORT\>). This functionality requires a secret code (default value: cdecanntool). See [session.py](simple-backend/nlpviewer_backend/handlers/session.py) to modify this functionality.

Admins can browse the document pairs loaded onto the interface. For each document pair, they can iterate through each mention on the left document to look for corefering mentions from the right document. This is identical to the annotation process albeit non-editable.

### Task Records

The URLs for each task are generated by hashing the document pair name. Additionally, at the end of each task, we generate a unique code and present it to the annotator. This code helps to keep track of finished tasks, especially for tasks where the annotator (correctly) did not find any coreference links (i.e., no entries in the database).

```python
import hashlib

doc_pair_str = "pair_36185_and_36231"
hash_pair = hashlib.sha256(str.encode(doc_pair_str)).hexdigest()
# hash_pair --> ceab189e1e1c78c25e2900afbd925c114df34fb3c82983916f5236ea3b9db204

# the annotation task can be found at the below URL
# select URL and PORT accordingly
URL=""
PORT=""
task_url = f"{URL}:{PORT}/?tasks={hash_pair}"

# secret code generation
# this code is presented to the annotator on the interface upon finishing the above task
# default value, feel free to edit in simple-backend/nlpviewer_backend/utils.py
suffix = "cdecanntool"
inp_str = f"{hash_pair}-{suffix}"
unique_code = hashlib.sha256(str.encode(inp_str)).hexdigest()
# unique_code --> c9573bafa15e10a90266a4b888facba918eb1ebb3b98935dec2e8fcd2c10710e
```

**Note**: to solve an annotation task on the interface, you are required to specify the task ID.

### Annotation Logs

This toolkit also keeps track of the time spent by an annotator on a given task. This captures the time between opening the document pair and the finishing the last event on the left document.

* To view the Django admin site, see the below steps. The time spent by each annotator on a given task can be viewed in the AnnotationLog table.

```bash
# create superuser and visit <HOST>:<PORT>/admin
python simple-backend/manage.py createsuperuser
```
